<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepScope - Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================
           DASHBOARD WITH REAL DATA
           ========================================== */

        :root {
            --primary-burgundy: #6B1F1F;
            --primary-crimson: #8B2F2F;
            --primary-rose: #A94442;
            --deep-burgundy: #4A1515;
            --accent-red: #FF6B6B;
            --accent-pink: #FFB3B3;
            --white: #FFFFFF;
            --font-display: 'Playfair Display', serif;
            --font-body: 'DM Sans', sans-serif;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, var(--deep-burgundy) 0%, var(--primary-burgundy) 50%, var(--primary-crimson) 100%);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* DNA Background */
        .dna-background {
            position: fixed;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            opacity: 0.4;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 800"><path d="M200 50 Q220 100 200 150 Q180 200 200 250 Q220 300 200 350 Q180 400 200 450 Q220 500 200 550 Q180 600 200 650 Q220 700 200 750" stroke="%23FFB3B3" stroke-width="4" fill="none" opacity="0.3"/><circle cx="200" cy="100" r="15" fill="%23FF6B6B" opacity="0.5"/><circle cx="200" cy="250" r="15" fill="%23FF6B6B" opacity="0.5"/><circle cx="200" cy="400" r="15" fill="%23FF6B6B" opacity="0.5"/><circle cx="200" cy="550" r="15" fill="%23FF6B6B" opacity="0.5"/><circle cx="200" cy="700" r="15" fill="%23FF6B6B" opacity="0.5"/></svg>') no-repeat center right;
            background-size: contain;
        }

        /* Navigation */
        .navbar {
            position: relative;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-xl);
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-red), var(--primary-rose));
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            opacity: 0.3;
        }

        .brand-name {
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .nav-menu {
            display: flex;
            gap: var(--spacing-sm);
        }

        .nav-item {
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius-lg);
            font-size: 0.9375rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            color: var(--white);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            background: var(--primary-rose);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(169, 68, 66, 0.3);
        }

        /* Main Container */
        .dashboard-container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }

        .dashboard-header {
            margin-bottom: var(--spacing-xl);
            animation: fadeInUp 0.8s ease-out;
        }

        .dashboard-title {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 700;
            line-height: 1.2;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--white) 0%, rgba(255, 255, 255, 0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-sm);
        }

        .patient-info-header {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: var(--spacing-sm);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        /* Card Styles */
        .dashboard-card {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            color: var(--white);
        }

        /* Diagnosis Summary Card */
        .diagnosis-summary {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .diagnosis-main {
            background: linear-gradient(135deg, var(--primary-crimson), var(--primary-rose));
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
        }

        .diagnosis-name {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .diagnosis-tissue {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: var(--spacing-md);
        }

        .confidence-section {
            margin-top: var(--spacing-md);
        }

        .confidence-label {
            font-size: 0.875rem;
            margin-bottom: var(--spacing-xs);
        }

        .confidence-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-pink));
            border-radius: 5px;
            transition: width 1s ease-out;
        }

        .diagnosis-metadata {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-sm);
        }

        .metadata-item {
            background: rgba(255, 255, 255, 0.05);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
        }

        .metadata-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .metadata-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Patient Info Card */
        .patient-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-sm);
        }

        .patient-item {
            background: rgba(255, 255, 255, 0.03);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .patient-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.25rem;
        }

        .patient-value {
            font-size: 1rem;
            font-weight: 600;
        }

        /* Treatment Plan Card - EXPANDED */
        .treatment-plan-card {
            grid-column: 1 / -1;
        }

        .treatment-sections {
            display: grid;
            gap: var(--spacing-md);
        }

        .treatment-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .treatment-section-header {
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .treatment-section-header:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .treatment-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .section-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-red), var(--primary-rose));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .expand-icon {
            transition: transform 0.3s ease;
        }

        .treatment-section.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .treatment-section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .treatment-section.expanded .treatment-section-content {
            max-height: 1000px;
        }

        .treatment-section-text {
            padding: var(--spacing-lg);
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 0.9375rem;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Recent Visits Card */
        .visits-info {
            text-align: center;
            padding: var(--spacing-xl);
            color: rgba(255, 255, 255, 0.6);
        }

        .visits-recommendation {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-md);
        }

        .visits-recommendation-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-pink);
            margin-bottom: var(--spacing-sm);
        }

        .visits-recommendation-text {
            font-size: 0.9375rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 968px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-title {
                font-size: 2.5rem;
            }

            .nav-menu {
                display: none;
            }

            .diagnosis-metadata,
            .patient-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dna-background"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo-icon"></div>
            <span class="brand-name">DeepScope</span>
        </div>
        <div class="nav-menu">
            <a href="/" class="nav-item">New diagnosis</a>
            <a href="/dashboard" class="nav-item active">Dashboard</a>
            <a href="/treatment" class="nav-item">Treatment</a>
            <a href="/history" class="nav-item">History</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <h1 class="dashboard-title">Diagnosis Dashboard</h1>
            <% if (diagnosis) { %>
                <p class="patient-info-header">
                    Patient: <%= patient.sex %>, <%= patient.age %> years old ‚Ä¢ 
                    Date: <%= new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>
                </p>
            <% } else { %>
                <p class="patient-info-header">No diagnosis data available. Please complete a diagnosis first.</p>
            <% } %>
        </header>

        <% if (diagnosis) { %>
        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Diagnosis Summary -->
            <div class="dashboard-card">
                <h2 class="section-title">Diagnosis Summary</h2>
                
                <div class="diagnosis-summary">
                    <div class="diagnosis-main">
                        <h3 class="diagnosis-name"><%= diagnosis.predicted_class || 'Unknown' %></h3>
                        <p class="diagnosis-tissue">Tissue Type: <%= diagnosis.tissue_type || 'N/A' %></p>
                        
                        <div class="confidence-section">
                            <div class="confidence-label">
                                AI Confidence: <%= (diagnosis.confidence * 100).toFixed(1) %>%
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: <%= diagnosis.confidence * 100 %>%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="diagnosis-metadata">
                        <div class="metadata-item">
                            <div class="metadata-label">Classification</div>
                            <div class="metadata-value"><%= diagnosis.is_malignant ? 'Malignant' : 'Benign' %></div>
                        </div>
                        <div class="metadata-item">
                            <div class="metadata-label">Clinical Group</div>
                            <div class="metadata-value"><%= diagnosis.clinical_group || 'N/A' %></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patient Information -->
            <div class="dashboard-card">
                <h2 class="section-title">Patient Information</h2>
                
                <div class="patient-details">
                    <div class="patient-item">
                        <div class="patient-label">Age</div>
                        <div class="patient-value"><%= patient.age %> years</div>
                    </div>
                    <div class="patient-item">
                        <div class="patient-label">Sex</div>
                        <div class="patient-value"><%= patient.sex %></div>
                    </div>
                    <div class="patient-item">
                        <div class="patient-label">Activity Level</div>
                        <div class="patient-value"><%= patient.activity_level || 'Not specified' %></div>
                    </div>
                    <div class="patient-item">
                        <div class="patient-label">Smoking Status</div>
                        <div class="patient-value"><%= patient.smoking_status || 'Not specified' %></div>
                    </div>
                    <div class="patient-item">
                        <div class="patient-label">Family History</div>
                        <div class="patient-value"><%= patient.family_history ? 'Yes' : 'No' %></div>
                    </div>
                    <div class="patient-item">
                        <div class="patient-label">BMI</div>
                        <div class="patient-value"><%= patient.bmi || 'Not specified' %></div>
                    </div>
                    <% if (patient.comorbidities && patient.comorbidities.length > 0) { %>
                        <div class="patient-item" style="grid-column: 1 / -1;">
                            <div class="patient-label">Comorbidities</div>
                            <div class="patient-value"><%= patient.comorbidities.join(', ') %></div>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Treatment Plan - EXPANDED SECTION -->
            <div class="dashboard-card treatment-plan-card">
                <h2 class="section-title">Personalized Treatment Plan</h2>
                
                <div class="treatment-sections">
                    <% if (treatment && treatment.medical_treatment) { %>
                    <div class="treatment-section">
                        <div class="treatment-section-header" onclick="toggleSection(this)">
                            <div class="treatment-section-title">
                                <span class="section-icon">üè•</span>
                                Medical Treatment
                            </div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="treatment-section-content">
                            <div class="treatment-section-text"><%= treatment.medical_treatment %></div>
                        </div>
                    </div>
                    <% } %>

                    <% if (treatment && treatment.lifestyle_modifications) { %>
                    <div class="treatment-section">
                        <div class="treatment-section-header" onclick="toggleSection(this)">
                            <div class="treatment-section-title">
                                <span class="section-icon">üèÉ</span>
                                Lifestyle Modifications
                            </div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="treatment-section-content">
                            <div class="treatment-section-text"><%= treatment.lifestyle_modifications %></div>
                        </div>
                    </div>
                    <% } %>

                    <% if (treatment && treatment.diet_recommendations) { %>
                    <div class="treatment-section">
                        <div class="treatment-section-header" onclick="toggleSection(this)">
                            <div class="treatment-section-title">
                                <span class="section-icon">ü•ó</span>
                                Diet Recommendations
                            </div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="treatment-section-content">
                            <div class="treatment-section-text"><%= treatment.diet_recommendations %></div>
                        </div>
                    </div>
                    <% } %>

                    <% if (treatment && treatment.exercise_guidance) { %>
                    <div class="treatment-section">
                        <div class="treatment-section-header" onclick="toggleSection(this)">
                            <div class="treatment-section-title">
                                <span class="section-icon">üí™</span>
                                Exercise Guidance
                            </div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="treatment-section-content">
                            <div class="treatment-section-text"><%= treatment.exercise_guidance %></div>
                        </div>
                    </div>
                    <% } %>

                    <% if (treatment && treatment.next_steps) { %>
                    <div class="treatment-section">
                        <div class="treatment-section-header" onclick="toggleSection(this)">
                            <div class="treatment-section-title">
                                <span class="section-icon">üìã</span>
                                Next Steps
                            </div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="treatment-section-content">
                            <div class="treatment-section-text"><%= treatment.next_steps %></div>
                        </div>
                    </div>
                    <% } %>

                    <% if (treatment && treatment.follow_up) { %>
                    <div class="treatment-section">
                        <div class="treatment-section-header" onclick="toggleSection(this)">
                            <div class="treatment-section-title">
                                <span class="section-icon">üìÖ</span>
                                Follow-up Schedule
                            </div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="treatment-section-content">
                            <div class="treatment-section-text"><%= treatment.follow_up %></div>
                        </div>
                    </div>
                    <% } %>
                </div>
            </div>

            <!-- Recent Visits -->
            <div class="dashboard-card" style="grid-column: 1 / -1;">
                <h2 class="section-title">Recommended Visits</h2>
                
                <div class="visits-info">
                    <% if (diagnosis.is_malignant) { %>
                        <div class="visits-recommendation">
                            <div class="visits-recommendation-title">‚ö†Ô∏è Urgent Consultation Required</div>
                            <div class="visits-recommendation-text">
                                Based on the malignant diagnosis, please schedule an oncology consultation within 1-2 weeks. 
                                Bring this diagnosis report and all medical records to your appointment.
                            </div>
                        </div>
                    <% } else { %>
                        <p>No urgent visits required currently.</p>
                        <div class="visits-recommendation">
                            <div class="visits-recommendation-title">Recommended Follow-up</div>
                            <div class="visits-recommendation-text">
                                Schedule a routine follow-up with your gastroenterologist within 4-6 weeks to discuss this diagnosis 
                                and establish a monitoring plan.
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        <% } else { %>
        <!-- No Data State -->
        <div class="dashboard-card" style="text-align: center; padding: 4rem;">
            <h2 style="font-size: 2rem; margin-bottom: 1rem;">No Diagnosis Data Available</h2>
            <p style="font-size: 1.125rem; color: rgba(255, 255, 255, 0.7); margin-bottom: 2rem;">
                Complete a diagnosis to see your dashboard with personalized treatment recommendations.
            </p>
            <a href="/" style="display: inline-block; padding: 1rem 2rem; background: linear-gradient(135deg, var(--accent-red), var(--primary-rose)); color: white; text-decoration: none; border-radius: 12px; font-weight: 600; transition: transform 0.3s ease;">
                Start New Diagnosis
            </a>
        </div>
        <% } %>
    </div>

    <script>
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('expanded');
        }

        // Auto-expand first section on load
        window.addEventListener('load', () => {
            const firstSection = document.querySelector('.treatment-section');
            if (firstSection) {
                firstSection.classList.add('expanded');
            }
        });
    </script>
</body>
</html>
